<aura:component controller="DiscountController" implements="flexipage:availableForAllPageTypes" access="global">
    <aura:attribute name="discounts" type="Object[]"/>
    <aura:attribute name="error" type="String"/>
    <aura:attribute name="isModalOpen" type="Boolean" default="false"/>
    <aura:attribute name="isLoading" type="Boolean" default="false"/>
    <aura:attribute name="recordsPerPage" type="Integer" default="10"/>
    <aura:attribute name="recordsPerPageString" type="String" default="10"/>
    <aura:attribute name="currentPage" type="Integer" default="1"/>
    <aura:attribute name="totalPages" type="Integer"/>
    <aura:attribute name="allRecordsCount" type="Integer"/>
    <aura:attribute name="columns" type="List"/>
    <aura:attribute name="pageSizeOptions" type="List"/>

    <aura:handler name="init" value="{!this}" action="{!c.init}"/>

    <lightning:card>
        <aura:if isTrue="{!v.isLoading}">
            <lightning:spinner alternativeText="{!$Label.c.loadingSpinnerText}" size="medium"/>
        </aura:if>

        <div class="slds-m-around_large slds-grid slds-grid_align-end">
            <lightning:button label="{!$Label.c.addDiscountButton}" variant="brand" onclick="{!c.openModal}"/>
        </div>

        <aura:if isTrue="{!not(empty(v.discounts))}">
            <div class="slds-p-horizontal_medium">
                <div class="slds-grid slds-grid_align-end">
                    <lightning:combobox
                        name="recordsPerPage"
                        label="{!$Label.c.recordsPerPage}"
                        value="{!v.recordsPerPageString}"
                        options="{!v.pageSizeOptions}"
                        onchange="{!c.handlePageSizeChange}"
                        class="slds-m-bottom_small slds-col slds-size_1-of-12"
                    />
                </div>

                <lightning:datatable
                    keyField="Id"
                    data="{!v.discounts}"
                    columns="{!v.columns}"
                    hideCheckboxColumn="true"
                    class="slds-m-top_medium"
                />

                <div class="slds-m-top_medium slds-align_absolute-center">
                    <lightning:button label="{!$Label.c.firstButton}" onclick="{!c.handleFirstPageClick}" disabled="{!v.currentPage == 1}" class="slds-m-horizontal_x-small"/>
                    <lightning:button label="{!$Label.c.previousButton}" onclick="{!c.handlePreviousPageClick}" disabled="{!v.currentPage == 1}" class="slds-m-horizontal_x-small"/>
                    <span class="slds-m-horizontal_small">{!v.currentPage} / {!v.totalPages}</span>
                    <lightning:button label="{!$Label.c.nextButton}" onclick="{!c.handleNextPageClick}" disabled="{!v.currentPage == v.totalPages}" class="slds-m-horizontal_x-small"/>
                    <lightning:button label="{!$Label.c.lastButton}" onclick="{!c.handleLastPageClick}" disabled="{!v.currentPage == v.totalPages}" class="slds-m-horizontal_x-small"/>
                </div>
            </div>
        </aura:if>
        <aura:if isTrue="{!and(not(v.isLoading), empty(v.discounts), empty(v.error)) }">
            <div class="slds-text-align_center slds-text-heading_medium">{!$Label.c.noRecordsFound}</div>
        </aura:if>

        <aura:if isTrue="{!(empty(v.error))}">
            <p class="slds-text-color_error">{!v.error}</p>
        </aura:if>
    </lightning:card>

    <aura:if isTrue="{!v.isModalOpen}">
        <div class="my-system-spinner">
            <section role="dialog" class="slds-modal slds-fade-in-open slds-backdrop">
                <div class="slds-modal__container slds-p-horizontal_small">
                    <header class="slds-modal__header">
                        <button class="slds-button slds-modal__close" onclick="{!c.closeModal}" title="Close">
                            <lightning:icon iconName="utility:close" alternativeText="Close" variant="bare"/>
                        </button>
                    </header>
                    <div class="slds-modal__content">
                        <lightning:flow aura:id="discountFlow" onstatuschange="{!c.handleFlowStatusChange}"/>
                    </div>
                </div>
            </section>
        </div>
    </aura:if>
</aura:component>